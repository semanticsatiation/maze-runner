<app-tile-keys></app-tile-keys>

<div class="maze-options flex-column-center">
    <div class="modify-maze-options">
        <a class="link-light" href="#" (click)="clearMaze()">
            clear maze
        </a>
    
        <a class="link-light" href="#" (click)="clearPath()">
            clear path
        </a>


        <div class="flex-column-center">
            <label for="speed">Speed</label>

            <select [disabled]="isSolving" name="speed" id="speed" [value]="speed" (change)="adjustSpeed($event)">
                <option *ngFor="let speedItem of speeds; let i = index;" [selected]="speedItem[1] === speed.toString()" [value]="speeds[i][1]">{{speedItem[0]}}</option>
            </select>
        </div>

        <div class="flex-column-center">
            <label for="zoom">Zoom</label>

            <select name="zoom" id="zoom" [value]="zoom" (change)="adjustZoom($event)">
                <option *ngFor="let zoomItem of zooms; let i = index;" [selected]="zoomItem === zoom" [value]="zooms[i]">{{zoomItem}}%</option>
            </select>
        </div>

        <div class="flex-column-center">
            <span>Tile Type</span>
            <div class="tile-radios">
                <input type="radio" [checked]="currentTileType === 'walls'" (change)="changeTileType($event)" value="walls" name="walls" id="walls">
                <label for="walls">Walls</label>
                <input type="radio" [checked]="currentTileType === 'weights'" (change)="changeTileType($event)" value="weights" name="weights" id="weights">
                <label for="weights">Weights (cost of 20)</label>
            </div>
        </div>

        <div class="flex-column-center">
            <label for="algorithm">Algorithm</label>

            <select name="algorithm" id="algorithm" [value]="algorithm" (change)="setAlgorithm($event)" [disabled]="isSolving">
                <option *ngFor="let algorithmItem of algorithms; let i = index;" [selected]="algorithmItem === algorithm" [value]="algorithms[i]">{{algorithmItem}}</option>
            </select>
        </div>

        <div class="buttons-container">
            <div class="button-container flex-column-center">
                <label for="height">Height</label>

                <div>
                    <span>
                        <button [disabled]="isSolving" class="btn btn-danger btn-number" (click)="setDimensions({event: undefined, number: height - 1}, 'height')" type="button">
                            -
                        </button>
                    </span>
                    <input id="height" name="height" class="form-control" (change)="setDimensions({event: $event, number: undefined}, 'height')" [disabled]="isSolving" type="text" [value]="height">
                    <span>
                        <button [disabled]="isSolving" class="btn btn-success btn-number" (click)="setDimensions({event: undefined, number: height + 1}, 'height')" type="button">
                            +
                        </button>
                    </span>
                </div>
            </div>

            <div class="button-container flex-column-center">
                <label for="width">Width</label>

                <div>
                    <span>
                        <button [disabled]="isSolving" class="btn btn-danger btn-number" (click)="setDimensions({event: undefined, number: width - 1}, 'width')" type="button">
                            -
                        </button>
                    </span>
                    <input id="width" name="width" class="form-control" (change)="setDimensions({event: $event, number: undefined}, 'width')" [disabled]="isSolving" type="text" [value]="width">
                    <span>
                        <button [disabled]="isSolving" class="btn btn-success btn-number" (click)="setDimensions({event: undefined, number: width + 1}, 'width')" type="button">
                            +
                        </button>
                    </span>
                </div>
            </div>
        </div>
    </div>


    <button *ngIf="isSolving else elseTemplate" type="button" class="btn btn-danger run-maze-button" (click)="isSolving = false;">
        stop maze
    </button>
    <ng-template #elseTemplate>
        <button type="button" class="btn btn-success run-maze-button" (click)="solve()">
            run maze
        </button>
    </ng-template>
</div>

<div class="maze-stats">
    <span>Time Taken: <span class="stat">{{timeTaken}}</span> milliseconds</span>
    <span>Steps Taken (with weights): <span class="stat">{{totalSteps}}</span></span>
    <span>Total Final Path: <span class="stat">{{finalTotal}}</span></span>
    <span>Total Tiles Seen: <span class="stat">{{seenTotal}}/{{(width * height) - wallsTotal}}</span>  (<span class="stat">{{((seenTotal / ((width * height) - wallsTotal)) * 100).toFixed(2)}}%</span>)</span>
</div>

<div class="grid-container">
    <ul class="maze" (contextmenu)="$event.preventDefault()">
        <li class="row" *ngFor="let row of squares; let ri = index;">
            <div
                [ngStyle]="{height: calcZoom(), width: calcZoom()}"
                *ngFor="let block of row; let ci = index;"

                (mouseover)="toggleTile(block)" 
                (mousedown)="mouseIsDown = true;"
                (mouseup)="mouseIsDown = false"
                (dblclick)="placeGoal(block, 'end')"
                (click)="clickToggle(block)"
                (contextmenu)="placeGoal(block, 'start')"


                [ngClass]="[
                    true && 'square', 
                    areSamePos(currentNode, block) ? 'current-tile' : '',
                    block.weight ? 'weight' : '',
                    block.wall ? 'wall' : '',
                    areSamePos(getStart(), block) ? 'start-tile' : '', 
                    areSamePos(getEnd(), block) ? 'end-tile' : '',
                    !block.final && !areSamePos(getStart(), block) && block.seen ? 'seen-tile' : '',
                    block.final ? 'final-tile' : '',
                ]"
            >
            </div>
        </li>
    </ul>
</div>